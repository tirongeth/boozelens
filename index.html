<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BoozeLens üéâ | Picture Perfect Party</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#00ff88">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BoozeLens">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="BoozeLens">
    <meta name="msapplication-TileColor" content="#00ff88">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./assets/manifest-D3YZbI-M-D06rCt6B.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="./icons/icon-152x152.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-16x16.png">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- BoozeLens Styles -->
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script type="module" crossorigin src="./assets/index-DEHNkM1m.js"></script>
  <link rel="stylesheet" crossorigin href="./assets/index-D8DKlKvX.css">
</head>
<body>
    <div class="background"></div>
    <div class="particles" id="particles"></div>
    
    <!-- Auth Container (Login/Signup) -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <h2 id="authTitle">Welcome to BoozeLens</h2>
            
            <div class="auth-error" id="authError"></div>
            
            <div class="auth-loading" id="authLoading">
                <div class="loading-spinner"></div>
                <p>Please wait...</p>
            </div>
            
            <form id="authForm" autocomplete="on">
                <div class="form-group">
                    <label for="authEmail">Email</label>
                    <input type="email" id="authEmail" required autocomplete="email" placeholder="your.email@hsg.ch">
                </div>
                <div class="form-group">
                    <label for="authPassword">Password</label>
                    <input type="password" id="authPassword" required autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group" id="usernameGroup" style="display: none;">
                    <label for="authUsername">Username</label>
                    <input type="text" id="authUsername" autocomplete="username" placeholder="Choose a unique username">
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="authSubmitBtn">
                    <span id="authButton">Login</span>
                </button>
            </form>
            <div class="auth-toggle">
                <span id="authToggleText">Don't have an account?</span>
                <a onclick="toggleAuthMode()" id="authToggleLink">Sign up</a>
            </div>
        </div>
    </div>
    
    <!-- Alert Banner -->
    <div class="alert-banner" id="alertBanner">
        <span id="alertText"></span>
    </div>
    
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-beer"></i>
                BoozeLens
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><button class="nav-item active" onclick="switchSection('dashboard')" type="button">
                    <i class="fas fa-home"></i> Dashboard
                </button></li>
                <li><button class="nav-item" onclick="switchSection('devices')" type="button">
                    <i class="fas fa-microchip"></i> Devices
                </button></li>
                <li><button class="nav-item" onclick="switchSection('friends')" type="button">
                    <i class="fas fa-users"></i> Friends
                </button></li>
                <li><button class="nav-item" onclick="switchSection('games')" type="button">
                    <i class="fas fa-gamepad"></i> Games
                </button></li>
                <li><button class="nav-item" onclick="switchSection('achievements')" type="button">
                    <i class="fas fa-trophy"></i> Achievements
                </button></li>
                <li><button class="nav-item" onclick="switchSection('drinks')" type="button">
                    <i class="fas fa-beer"></i> Drinks
                </button></li>
                <li><button class="nav-item" onclick="switchSection('emergency')" type="button">
                    <i class="fas fa-ambulance"></i> Emergency
                </button></li>
                <li><button class="nav-item" onclick="switchSection('settings')" type="button">
                    <i class="fas fa-cog"></i> Settings
                </button></li>
            </ul>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" type="button">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>
    
    <!-- User Profile Widget -->
    <div class="user-profile" id="userProfile" style="display: none;">
        <h4 id="profileName">Loading...</h4>
        <p id="profileEmail">...</p>
        <p>Devices: <span id="deviceCount">0</span></p>
        <p>Friends: <span id="friendCount">0</span></p>
        <button class="btn" onclick="signOut()">
            <i class="fas fa-sign-out-alt"></i> Sign Out
        </button>
    </div>
    
    <!-- Connection Status -->
    <div class="connection-status">
        <span class="status-dot"></span>
        <span id="connectionStatus">Connecting...</span>
    </div>
    
    <div class="container">
        <header>
            <h1>üéâ BoozeLens üéâ</h1>
            <p class="subtitle">Picture Perfect Party</p>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showModal('pair-device')">
                    <i class="fas fa-link"></i> Pair Device
                </button>
                <button class="btn" onclick="showModal('checkin')">
                    <i class="fas fa-location-dot"></i> Check In
                </button>
                <button class="btn" onclick="callUber()">
                    <i class="fas fa-taxi"></i> Call Uber
                </button>
                <button class="btn btn-danger" onclick="showModal('emergency')">
                    <i class="fas fa-exclamation-triangle"></i> Emergency
                </button>
            </div>
        </header>
        
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="party-stats">
                <div class="stat-card" onclick="showNotification('Party statistics!')">
                    <div class="stat-icon">üéä</div>
                    <div class="stat-value" id="partyAverage">0.00‚Ä∞</div>
                    <div class="stat-label">Party Average</div>
                </div>
                <div class="stat-card" onclick="showModal('safe-friends')">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="safeFriends">0</div>
                    <div class="stat-label">Safe to Drive</div>
                </div>
                <div class="stat-card" onclick="showModal('locations')">
                    <div class="stat-icon">üìç</div>
                    <div class="stat-value" id="activeLocations">3</div>
                    <div class="stat-label">Party Spots</div>
                </div>
                <div class="stat-card" onclick="showHydrationReminder()">
                    <div class="stat-icon">üíß</div>
                    <div class="stat-value" id="hydrationTime">15m</div>
                    <div class="stat-label">Until Water Break</div>
                </div>
            </div>
            
            <div class="visualizer" id="visualizer">
                <!-- Music visualizer bars will be generated here -->
            </div>
            
            <div class="dashboard" id="friendsGrid">
                <!-- Friend cards will be dynamically inserted here -->
            </div>
            
            <div class="leaderboard">
                <h2>üèÜ Tonight's Champions üèÜ</h2>
                <div id="leaderboardList">
                    <!-- Leaderboard items will be inserted here -->
                </div>
            </div>
            
            <div class="info-box">
                <h3>üîå How to Connect Your Breathalyzer</h3>
                <p><strong>For Arduino/ESP32 Devices:</strong></p>
                <ol style="margin-left: 20px;">
                    <li>Power on your device and connect to its WiFi hotspot</li>
                    <li>Complete the setup and note your unique Device ID</li>
                    <li>Click "Pair Device" and enter your Device ID</li>
                    <li>Your BAC readings will update in real-time</li>
                </ol>
            </div>
            
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message">
                        <div class="chat-author">System</div>
                        <div>Welcome to BoozeLens Chat! Stay safe and have fun! üéâ</div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="handleChatEnter(event)">
                    <button class="btn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Devices Section -->
        <section id="devices" class="section">
            <h2>üì± My Devices</h2>
            
            <div class="card">
                <h3>Pair New Device</h3>
                <p>After setting up your breathalyzer via its WiFi hotspot, enter the Device ID shown on the device:</p>
                
                <div class="form-group" style="margin: 20px 0;">
                    <input type="text" id="deviceIdInput" placeholder="Enter Device ID (e.g., HSG_abc123)" style="text-transform: uppercase;">
                </div>
                
                <button class="btn btn-primary" onclick="pairDeviceById()">
                    <i class="fas fa-link"></i> Pair Device
                </button>
                
                <div class="info-box" style="margin-top: 20px;">
                    <h4>Setup Instructions:</h4>
                    <ol>
                        <li>Power on your breathalyzer device</li>
                        <li>Double-flip the switch to enter setup mode</li>
                        <li>Connect to the device's WiFi network</li>
                        <li>Complete the setup in your browser</li>
                        <li>Note the Device ID shown on the screen</li>
                        <li>Enter the Device ID above to pair</li>
                    </ol>
                </div>
            </div>
            
            <div class="device-list" id="deviceList">
                <!-- Devices will be populated here -->
            </div>
        </section>
        
        <!-- Friends Section -->
        <section id="friends" class="section">
            <h2>üë• Friends</h2>
            
            <div class="friends-search">
                <input type="text" class="search-input" id="friendSearchInput" placeholder="Search for friends by username or email...">
                <button class="btn btn-primary" onclick="searchFriends()">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
            
            <div id="searchResults" style="margin-bottom: 30px;">
                <!-- Search results will appear here -->
            </div>
            
            <div class="card">
                <h3>Friend Requests</h3>
                <div id="friendRequests">
                    <!-- Friend requests will be shown here -->
                </div>
            </div>
            
            <div class="card">
                <h3>My Friends</h3>
                <div id="friendsList">
                    <!-- Friends list will be populated here -->
                </div>
            </div>
        </section>
        
        <!-- Games Section -->
        <section id="games" class="section">
            <h2>üéÆ Party Games üéÆ</h2>
            <div class="games-grid">
                <div class="game-card" onclick="startGame('never-have-i-ever')">
                    <div class="game-icon">üôä</div>
                    <div class="game-title">Never Have I Ever</div>
                    <div class="game-players">2-20 players</div>
                </div>
                <div class="game-card" onclick="startGame('truth-or-dare')">
                    <div class="game-icon">üéØ</div>
                    <div class="game-title">Truth or Dare</div>
                    <div class="game-players">3-10 players</div>
                </div>
                <div class="game-card" onclick="startGame('kings-cup')">
                    <div class="game-icon">üëë</div>
                    <div class="game-title">King's Cup</div>
                    <div class="game-players">4-12 players</div>
                </div>
                <div class="game-card" onclick="startGame('beer-pong')">
                    <div class="game-icon">üèì</div>
                    <div class="game-title">Beer Pong Tracker</div>
                    <div class="game-players">2v2</div>
                </div>
                <div class="game-card" onclick="startGame('flip-cup')">
                    <div class="game-icon">ü•§</div>
                    <div class="game-title">Flip Cup Timer</div>
                    <div class="game-players">Teams</div>
                </div>
                <div class="game-card" onclick="startGame('trivia')">
                    <div class="game-icon">üß†</div>
                    <div class="game-title">Party Trivia</div>
                    <div class="game-players">Unlimited</div>
                </div>
            </div>
        </section>
        
        <!-- Achievements Section -->
        <section id="achievements" class="section">
            <h2>üèÖ Party Achievements üèÖ</h2>
            <div class="achievement-stats">
                <p>Unlocked: <span data-achievement-stats>0/0</span></p>
            </div>
            <div class="achievements-grid">
                <div class="achievement unlocked" title="Joined your first party!">
                    <div class="achievement-icon">üéâ</div>
                    <div class="achievement-name">First Timer</div>
                </div>
                <div class="achievement unlocked" title="Stayed safe all night">
                    <div class="achievement-icon">üòá</div>
                    <div class="achievement-name">Responsible</div>
                </div>
                <div class="achievement" title="Win 5 party games">
                    <div class="achievement-icon">üèÜ</div>
                    <div class="achievement-name">Game Master</div>
                </div>
                <div class="achievement" title="Check in at 10 parties">
                    <div class="achievement-icon">üìç</div>
                    <div class="achievement-name">Party Animal</div>
                </div>
                <div class="achievement" title="Help a friend get home safe">
                    <div class="achievement-icon">ü¶∏</div>
                    <div class="achievement-name">Guardian Angel</div>
                </div>
                <div class="achievement" title="Stay hydrated for 3 hours">
                    <div class="achievement-icon">üíß</div>
                    <div class="achievement-name">Hydro Homie</div>
                </div>
                <div class="achievement" title="Dance for 30 minutes straight">
                    <div class="achievement-icon">üï∫</div>
                    <div class="achievement-name">Dance Machine</div>
                </div>
                <div class="achievement" title="Make it to sunrise">
                    <div class="achievement-icon">üåÖ</div>
                    <div class="achievement-name">Sunrise Warrior</div>
                </div>
            </div>
        </section>
        
        <!-- Drinks Section -->
        <section id="drinks" class="section">
            <h2>üçª Drink Tracker üçª</h2>
            
            <div class="card" style="margin-bottom: 30px;">
                <h3>Log a Drink</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div>
                        <label style="display: block; margin-bottom: 10px;">Drink Type:</label>
                        <select id="drinkType" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white;">
                            <option value="beer">üç∫ Beer</option>
                            <option value="wine">üç∑ Wine</option>
                            <option value="shot">ü•É Shot</option>
                            <option value="cocktail">üç∏ Cocktail</option>
                            <option value="mixed">ü•§ Mixed Drink</option>
                            <option value="champagne">ü•Ç Champagne</option>
                            <option value="water">üíß Water</option>
                            <option value="other">üçπ Other</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 10px;">Amount (ml):</label>
                        <input type="number" id="drinkAmount" placeholder="330" value="330" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 10px;">Alcohol %:</label>
                        <input type="number" id="alcoholPercent" placeholder="5" value="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white;">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="logDrink()">
                    <i class="fas fa-plus"></i> Add Drink
                </button>
            </div>
            
            <div class="party-stats">
                <div class="stat-card">
                    <div class="stat-icon">üç∫</div>
                    <div class="stat-value" id="totalDrinks">0</div>
                    <div class="stat-label">Total Drinks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ü•É</div>
                    <div class="stat-value" id="totalAlcohol">0ml</div>
                    <div class="stat-label">Pure Alcohol</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíß</div>
                    <div class="stat-value" id="totalWater">0</div>
                    <div class="stat-label">Waters</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value" id="drinkRate">0</div>
                    <div class="stat-label">Drinks/Hour</div>
                </div>
            </div>
            
            <div class="card chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3>üìä Drink Distribution</h3>
                    <button class="chart-toggle" onclick="toggleChart()">
                        <span id="chartToggleText">Hide Chart</span>
                    </button>
                </div>
                <div class="chart-wrapper" id="chartWrapper">
                    <canvas id="drinkChart" width="400" height="250"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>üìú Drink History</h3>
                <div id="drinkHistory" style="max-height: 400px; overflow-y: auto;">
                    <!-- Drink history will be populated here -->
                </div>
            </div>
            
            <div class="card" style="background: rgba(255, 68, 68, 0.1); border: 1px solid rgba(255, 68, 68, 0.3);">
                <h3>üö® Emergency Information</h3>
                <div id="emergencyDrinkInfo" style="margin: 20px 0;">
                    <p><strong>For First Responders:</strong></p>
                    <div id="emergencySummary">
                        <!-- Emergency summary will be populated here -->
                    </div>
                </div>
                <button class="btn btn-danger" onclick="showEmergencyReport()">
                    <i class="fas fa-file-medical"></i> Generate Emergency Report
                </button>
            </div>
        </section>
        
        <!-- Emergency Section -->
        <section id="emergency" class="section">
            <h2>üö® Emergency Services üö®</h2>
            <div class="emergency-grid">
                <div class="emergency-card" onclick="callEmergency('ambulance')">
                    <div class="emergency-icon">üöë</div>
                    <div class="game-title">Call Ambulance</div>
                    <div class="game-players">Emergency: 112</div>
                </div>
                <div class="emergency-card" onclick="callEmergency('campus-security')">
                    <div class="emergency-icon">üëÆ</div>
                    <div class="game-title">Campus Security</div>
                    <div class="game-players">HSG: +41 71 224 2424</div>
                </div>
                <div class="emergency-card" onclick="callEmergency('taxi')">
                    <div class="emergency-icon">üöï</div>
                    <div class="game-title">Safe Ride Home</div>
                    <div class="game-players">Multiple Options</div>
                </div>
                <div class="emergency-card" onclick="showModal('first-aid')">
                    <div class="emergency-icon">üè•</div>
                    <div class="game-title">First Aid Guide</div>
                    <div class="game-players">Quick Help</div>
                </div>
                <div class="emergency-card" onclick="showModal('buddy-system')">
                    <div class="emergency-icon">üë•</div>
                    <div class="game-title">Find My Buddy</div>
                    <div class="game-players">Location Sharing</div>
                </div>
                <div class="emergency-card" onclick="showModal('sober-friend')">
                    <div class="emergency-icon">ü§ù</div>
                    <div class="game-title">Call Sober Friend</div>
                    <div class="game-players">Designated Helpers</div>
                </div>
            </div>
        </section>
        
        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="profile-header">
                <div class="profile-avatar" onclick="showNotification('Profile picture upload coming soon!')">
                    <span id="profileInitial">?</span>
                </div>
                <div class="profile-info">
                    <h2 id="settingsUsername">Loading...</h2>
                    <p id="settingsEmail">...</p>
                    <p id="settingsPhone" style="display: none;">...</p>
                </div>
            </div>
            
            <div class="settings-grid">
                <div class="settings-section">
                    <h3>üë§ Profile Information</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="username" placeholder="Enter your username">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="emailDisplay" disabled style="opacity: 0.7;">
                        </div>
                        <button class="btn btn-primary" onclick="updateProfile()">Update Profile</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>üîí Account Security</h3>
                    <div class="linked-accounts">
                        <div class="account-item">
                            <div class="account-info">
                                <div class="account-icon email-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div>
                                    <strong>Email</strong>
                                    <p id="linkedEmail" style="margin: 0; opacity: 0.7;">...</p>
                                </div>
                            </div>
                            <span style="color: #00ff88;">‚úì Linked</span>
                        </div>
                    </div>
                    <button class="btn" onclick="changePassword()" style="margin-top: 20px; width: 100%;">
                        <i class="fas fa-key"></i> Change Password
                    </button>
                </div>
                
                <div class="settings-section">
                    <h3>üö® Emergency Information</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Home Address</label>
                            <textarea id="homeAddress" placeholder="Enter your home address for quick Uber rides"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Emergency Contact</label>
                            <input type="tel" id="emergencyContact" placeholder="+41 XX XXX XX XX">
                        </div>
                        <div class="form-group">
                            <label>Medical Information</label>
                            <textarea id="medicalInfo" placeholder="Allergies, conditions, medications..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Safety Notes</label>
                            <textarea id="safetyNotes" placeholder="Any other important information"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="saveEmergencyInfo()">Save Emergency Info</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>üîî Privacy & Notifications</h3>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <span>Share Location with Friends</span>
                            <small>Allow friends to see your party location</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shareLocation">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <span>Enable Notifications</span>
                            <small>Get alerts for friend requests and safety reminders</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifications" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <span>Public Profile</span>
                            <small>Allow others to find you by username</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="publicProfile" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <button class="btn btn-primary" onclick="savePrivacySettings()" style="margin-top: 20px; width: 100%;">Save Privacy Settings</button>
                </div>
                
                <div class="settings-section">
                    <h3>üíæ Data Management</h3>
                    <div style="display: grid; gap: 10px;">
                        <button class="btn" onclick="exportData()">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="btn" onclick="clearDrinkHistory()">
                            <i class="fas fa-trash"></i> Clear Drink History
                        </button>
                        <button class="btn btn-danger" onclick="deleteAccount()">
                            <i class="fas fa-user-times"></i> Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- BoozeLens App JavaScript -->

<!-- Main App Module -->
</body>
</html>